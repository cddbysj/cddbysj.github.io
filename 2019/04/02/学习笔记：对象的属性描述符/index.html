<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>学习笔记：对象的属性描述符 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="JavaScript 中的对象属性，并不只是简单的键值对，通过属性描述符 property descriptor ，我们可以更加灵活的配置对象属性以控制属性的行为，包括是否可枚举、是否可写、是否可配置，实现更强大的功能。实际上，对于对象而言，一共有 2 种属性：  数据属性 data property 访问属性 accessor property  数据属性通常我们见到的属性都是这样的：12345">
<meta name="keywords" content="JavaScript,学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="学习笔记：对象的属性描述符">
<meta property="og:url" content="https://cddbysj.github.io/2019/04/02/学习笔记：对象的属性描述符/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="JavaScript 中的对象属性，并不只是简单的键值对，通过属性描述符 property descriptor ，我们可以更加灵活的配置对象属性以控制属性的行为，包括是否可枚举、是否可写、是否可配置，实现更强大的功能。实际上，对于对象而言，一共有 2 种属性：  数据属性 data property 访问属性 accessor property  数据属性通常我们见到的属性都是这样的：12345">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-04-02T05:15:59.202Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="学习笔记：对象的属性描述符">
<meta name="twitter:description" content="JavaScript 中的对象属性，并不只是简单的键值对，通过属性描述符 property descriptor ，我们可以更加灵活的配置对象属性以控制属性的行为，包括是否可枚举、是否可写、是否可配置，实现更强大的功能。实际上，对于对象而言，一共有 2 种属性：  数据属性 data property 访问属性 accessor property  数据属性通常我们见到的属性都是这样的：12345">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://cddbysj.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-学习笔记：对象的属性描述符" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/02/学习笔记：对象的属性描述符/" class="article-date">
  <time datetime="2019-04-02T02:16:29.000Z" itemprop="datePublished">2019-04-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      学习笔记：对象的属性描述符
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>JavaScript 中的对象属性，并不只是简单的键值对，通过属性描述符 property descriptor ，我们可以更加灵活的配置对象属性以控制属性的行为，包括是否可枚举、是否可写、是否可配置，实现更强大的功能。实际上，对于对象而言，一共有 2 种属性：</p>
<ul>
<li>数据属性 data property</li>
<li>访问属性 accessor property</li>
</ul>
<h2 id="数据属性"><a href="#数据属性" class="headerlink" title="数据属性"></a>数据属性</h2><p>通常我们见到的属性都是这样的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码片段 1</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  name: <span class="string">'Sheldon'</span>,</span><br><span class="line">  age: <span class="number">29</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>上面的 <code>name</code> 和 <code>age</code> 都是数据属性。</p>
<h2 id="访问属性"><a href="#访问属性" class="headerlink" title="访问属性"></a>访问属性</h2><p>还有另一种形式，比如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码片段 2</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  name: <span class="string">'Bill'</span>,</span><br><span class="line">  surname: <span class="string">'Gates'</span>,</span><br><span class="line">  <span class="keyword">get</span> fullname() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> <span class="subst">$&#123;<span class="keyword">this</span>.surname&#125;</span>`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span> fullname(value) &#123;</span><br><span class="line">    [<span class="keyword">this</span>.name, <span class="keyword">this</span>.surname] = value.split(<span class="string">','</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">user.fullname <span class="comment">// Bill Gates</span></span><br><span class="line">user.fullname = <span class="string">'Sheldon Cooper'</span>;</span><br><span class="line">user.name <span class="comment">// Sheldon</span></span><br></pre></td></tr></table></figure></p>
<p>上面的 <code>name</code> 和 <code>surname</code> 是数据属性，<code>fullname</code> 则是访问属性。即凡是使用 <code>get prop()</code> <strong>或者</strong> <code>set prop()</code> 定义的属性，都是访问属性，不再是数据属性。</p>
<h2 id="数据属性的描述符"><a href="#数据属性的描述符" class="headerlink" title="数据属性的描述符"></a>数据属性的描述符</h2><p>对于数据属性而言，其描述符由 4 个 <code>flag</code> 组成：</p>
<ul>
<li><code>value</code> 属性的值</li>
<li><code>writable</code> 是否可写</li>
<li><code>enumerable</code> 是否可枚举，在类似 <code>for...in</code> 遍历中是否忽略</li>
<li><code>configurable</code> 是否可配置，即是否可以编辑描述符的 <code>flag</code></li>
</ul>
<p>对于使用字面量声明的对象属性而言，除了 <code>value</code> 之外的 3 个 <code>flag</code> 的默认值都为 <code>true</code>。使用 <code>Object.getOwnPropertyDescriptor(obj, prop)</code> 方法可以获取对象上某属性的描述符。比如获取上面代码片段 1 中 <code>user</code> 对象 <code>name</code> 属性的描述符：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码片段 3</span></span><br><span class="line"><span class="keyword">const</span> descriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(user, <span class="string">'name'</span>);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   "value": "Sheldon",</span></span><br><span class="line"><span class="comment">//   "writable": true,</span></span><br><span class="line"><span class="comment">//   "enumerable": true,</span></span><br><span class="line"><span class="comment">//   "configurable": true</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>如果想要精确地控制属性的行为，使用 <code>Object.defineProperty(obj, prop, descriptor)</code> 方法。使用这种方式，如果属性的某个 <code>flag</code> 没有显式指定，则默认值将是 <code>false</code> 。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码片段 4</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(user, <span class="string">'name'</span>, &#123;</span><br><span class="line">  value: <span class="string">'Sheldon'</span>,</span><br><span class="line">  writable: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> descriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(user, <span class="string">'name'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(descriptor, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   "value": "Sheldon",</span></span><br><span class="line"><span class="comment">//   "writable": true,</span></span><br><span class="line"><span class="comment">//   "enumerable": false,</span></span><br><span class="line"><span class="comment">//   "configurable": false</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到，除了显式指定的 <code>writable</code> ，其他未指定的 <code>flag</code> 的都是默认为 <code>false</code>。</p>
<h3 id="可枚举性"><a href="#可枚举性" class="headerlink" title="可枚举性"></a>可枚举性</h3><p>描述符的 <code>enumerable</code> 属性，称为“可枚举性”，如果该属性为 <code>false</code>，就表示某些操作会忽略当前属性。<br>目前，有四个操作会忽略 <code>enumerable</code> 为 <code>false</code> 的属性。</p>
<ul>
<li><code>for...in</code> 循环：只遍历对象自身的和继承的可枚举的属性。</li>
<li><code>Object.keys()</code>：返回对象自身的所有可枚举的属性的键名。</li>
<li><code>JSON.stringify()</code>：只串行化对象自身的可枚举的属性。</li>
<li><code>Object.assign()</code>： 忽略 <code>enumerable</code> 为 <code>false</code> 的属性，只拷贝对象自身的可枚举的属性。</li>
</ul>
<h3 id="可配置性"><a href="#可配置性" class="headerlink" title="可配置性"></a>可配置性</h3><p>描述符的 <code>configurable</code> 属性，表示该属性的 <code>flag</code> 是否可配置，一旦设为 <code>false</code> 不可逆。用的很少。</p>
<h2 id="访问属性的描述符"><a href="#访问属性的描述符" class="headerlink" title="访问属性的描述符"></a>访问属性的描述符</h2><p>访问属性的描述符不同于数据属性的描述符，没有 <code>value</code> 和 <code>writable</code> 这 2 个 <code>flag</code>，多了 <code>get</code> 和 <code>set</code>，所以一个访问属性的描述符可能有如下组成：</p>
<ul>
<li><code>get</code> – 无参数函数，当属性被读取时被调用</li>
<li><code>set</code> – 单参数函数，当属性被设置时被调用</li>
<li><code>enumerable</code> – 与数据属性一致</li>
<li><code>configurable</code> – 与数据属性一致</li>
</ul>
<p>访问属性的 <code>getter/setter</code> 可以直接使用字面量声明（如上面的代码片段 2 所示），也可以使用 <code>Object.defineProperty</code>，如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码片段 5</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  name: <span class="string">'Bill'</span>,</span><br><span class="line">  surname: <span class="string">'Gates'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(user, <span class="string">'fullname'</span>, &#123;</span><br><span class="line">  <span class="keyword">get</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> <span class="subst">$&#123;<span class="keyword">this</span>.surname&#125;</span>`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span>(value) &#123;</span><br><span class="line">    [<span class="keyword">this</span>.name, <span class="keyword">this</span>.surname] = value.split(<span class="string">','</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="getter-setter-应用"><a href="#getter-setter-应用" class="headerlink" title="getter/setter 应用"></a>getter/setter 应用</h3><p>使用 <code>get</code> 和 <code>set</code> 访问属性描述符，我们可以更加灵活控制属性的读写行为。比如对于 <code>user</code> 对象而言，可以限制 <code>name</code> 的长度：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码片段 6</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  <span class="keyword">get</span> name() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._name;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span> name(value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (value.length &gt; <span class="number">4</span>) &#123;</span><br><span class="line">      alert(<span class="string">'用户名长度不能超过 4 位'</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>._name = value; <span class="comment">// 这里使用 this._name 是一种广泛的通用约定</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="数据属性或访问属性"><a href="#数据属性或访问属性" class="headerlink" title="数据属性或访问属性"></a>数据属性或访问属性</h2><p>需要注意的是，一个属性要么是数据属性，要么是访问属性，不能两者皆是。相应地，如果同时给属性设置 <code>value</code> 和 <code>get</code> 这 2 个 <code>flag</code> 会报错。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码片段 7</span></span><br><span class="line"><span class="comment">// Error: Invalid property descriptor. Cannot both specify accessors and a value or writable attribute</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(&#123;&#125;, <span class="string">'prop'</span>, &#123;</span><br><span class="line">  <span class="keyword">get</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  value: <span class="number">1</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><p><a href="http://es6.ruanyifeng.com/#docs/object#%E5%B1%9E%E6%80%A7%E7%9A%84%E5%8F%AF%E6%9E%9A%E4%B8%BE%E6%80%A7%E5%92%8C%E9%81%8D%E5%8E%86" target="_blank" rel="noopener">ES6 入门 - 阮一峰</a></p>
</li>
<li><p><a href="https://javascript.info/property-accessors" target="_blank" rel="noopener">Modern Javascript Tutorial</a></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cddbysj.github.io/2019/04/02/学习笔记：对象的属性描述符/" data-id="cjtz8zxjg0000dkvgq7lqyx44" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/学习笔记/">学习笔记</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/04/02/学习笔记：原型与继承/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          学习笔记：原型与继承
        
      </div>
    </a>
  
  
    <a href="/2019/03/12/为什么-0-1-0-2-0-3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">为什么 0.1 + 0.2 !== 0.3</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git-Bash/">Git Bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/备忘录/">备忘录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习笔记/">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/宽松相等与严格相等/">宽松相等与严格相等</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/木材/">木材</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/求值策略/">求值策略</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/精度丢失/">精度丢失</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/装修/">装修</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面向对象/">面向对象</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Git-Bash/" style="font-size: 10px;">Git Bash</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/备忘录/" style="font-size: 10px;">备忘录</a> <a href="/tags/学习笔记/" style="font-size: 16.67px;">学习笔记</a> <a href="/tags/宽松相等与严格相等/" style="font-size: 10px;">宽松相等与严格相等</a> <a href="/tags/木材/" style="font-size: 10px;">木材</a> <a href="/tags/求值策略/" style="font-size: 10px;">求值策略</a> <a href="/tags/精度丢失/" style="font-size: 10px;">精度丢失</a> <a href="/tags/装修/" style="font-size: 10px;">装修</a> <a href="/tags/面向对象/" style="font-size: 13.33px;">面向对象</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/04/08/学习笔记：面向对象之混入/">学习笔记：面向对象之混入</a>
          </li>
        
          <li>
            <a href="/2019/04/04/学习笔记：class 语法糖/">学习笔记：class 语法糖</a>
          </li>
        
          <li>
            <a href="/2019/04/03/家具木材指南/">家具木材指南</a>
          </li>
        
          <li>
            <a href="/2019/04/02/学习笔记：原型与继承/">学习笔记：原型与继承</a>
          </li>
        
          <li>
            <a href="/2019/04/02/学习笔记：对象的属性描述符/">学习笔记：对象的属性描述符</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Bill Wen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>